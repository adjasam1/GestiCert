<title>GestiCert - Accueil</title>

<div title="Page d'accueil de {{ editedUser.nameUser }} {{ editedUser.firstNameUser }}">

  <section id="entete">

    <div title="{{ editedUser.nameUser }} {{ editedUser.firstNameUser }}">
      <div id="name">
        <p>
          <img src="assets/icons/person.png">
          <strong>{{ editedUser.nameUser | uppercase}}</strong><strong>{{ editedUser.firstNameUser }}</strong>
        </p>
      </div>

      <div id="profile">
        <a role="button" routerLink="/accueil/{{ editedUser.idRHUser }}/profil" title="Accès à mon profil">
          Mon Profil
        </a>
      </div>
      <div id="management">
        <a *ngIf="editedUser.profile.idProfile === 3" role="button" routerLink="/gestion/app"
           title="Accès à l'administration de l'application">
          Administration
        </a>
      </div>
    </div>

    <div id="deconnexion" title="Déconnexion de l'application">
      <a role="button" (click)="deconnect()">Déconnexion</a>
    </div>

  </section>

  <section id="cadre1">

    <div title="Formulaire de recherche de certificat">

      <h1>Recherche</h1>

      <div class="cadre2">
        <form #logForm="ngForm" [formGroup]="loginForm" novalidate (ngSubmit)="reset(logForm)">
          <div id="filtre1" title="Recherche par le code CCX">
            <strong>Code CCX : </strong>
            <span *ngFor="let col of cols" [ngSwitch]="col.field">
              <input *ngSwitchCase="'applicationCCX'" formControlName="applicationCCX" pInputText type="search"
                     (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)" placeholder="CCX"
                     title="Champ pour la recherche par le code CCX">
              </span>
          </div>
          <div class="filtre2">
            <strong>Application : </strong>
            <span *ngFor="let col of cols" [ngSwitch]="col.field">
              <input *ngSwitchCase="'applicationName'" formControlName="applicationName" pInputText type="search" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)" placeholder="NOM">
            </span>
          </div>
          <div class="filtre2">
            <strong>Environnement : </strong>
            <span *ngFor="let col of cols" [ngSwitch]="col.field">
              <input *ngSwitchCase="'environmentName'" pInputText type="search" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)" placeholder="NOM">
            </span>
          </div>
        </form>
        <form>
          <div id="filtre3">
            <strong>Année d'émission : </strong>
            <span *ngFor="let col of cols" [ngSwitch]="col.field">
              <input *ngSwitchCase="'dateIssue'" pInputText type="search" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)" placeholder="ANNEE">
            </span>
          </div>
          <div id="filtre4">
            <strong>Date d'émission : </strong>
            <span *ngFor="let col of cols" [ngSwitch]="col.field">
              <input *ngSwitchCase="'dateIssue'" pInputText type="date" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
            </span>
          </div>
          <div id="reset">
            <a role="button" (click)="reset(logForm)">Reset</a>
          </div>
        </form>
      </div>

      <div id="table" title="Liste de mes certificats">
        <h1>Liste des Certificats</h1>

        <div class="cadre2">
          <div class="autour">
            <p-table #dt [columns]="cols" [value]="listCertificates" [paginator]="true" [rows]="10" dataKey="applicationCCX" [reorderableColumns]="true"
                     selectionMode="single" [(selection)]="selectedCertificate" stateStorage="session" stateKey="statedemo-session">
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th id="th1" *ngFor="let col of cols" [pSortableColumn]="col.field" class="{{col.field}}" colspan="col.colspan" [ngStyle]="{'width': col.width}" pReorderableColumn>
                    {{col.header}}
                    <p-sortIcon [field]="col.field"></p-sortIcon>
                  </th>
                  <th class="th2">Validité</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-certificate let-columns="columns">
                <tr routerLink="/certificat/{{ certificate.idCertificate }}" [pSelectableRow]="certificate"
                    title="Certificat {{ certificate.environmentName }} de l'application {{ certificate.applicationName }}">
                  <td *ngFor="let col of cols" class="{{col.field}}">{{ certificate[col.field] }}</td>
                  <td class="th2">
                    <div *ngIf="((certificate.dateEndValidity | date: 'yyyy-MM-dd') > (alertDate | date: 'yyyy-MM-dd'))">
                      <img src="assets/icons/ok.svg"
                           title="Certificat {{ certificate.environmentName }} de l'application {{ certificate.applicationName }} valide">
                    </div>
                    <div *ngIf="((certificate.dateEndValidity | date: 'yyyy-MM-dd') < (dateNow | date: 'yyyy-MM-dd'))">
                      <img src="assets/icons/not_ok.svg"
                           title="Certificat {{ certificate.environmentName }} de l'application {{ certificate.applicationName }} non valide">
                      <a role="button" routerLink="certificat/{{certificate.idCertificate}}"
                         title="Demander le certificat {{ certificate.environmentName }} de l'application {{ certificate.applicationName }}">
                        Demander
                      </a>
                    </div>
                    <div *ngIf="((certificate.dateEndValidity | date: 'yyyy-MM-dd') >= (dateNow | date: 'yyyy-MM-dd')) && ((certificate.dateEndValidity | date: 'yyyy-MM-dd') <= (alertDate | date: 'yyyy-MM-dd'))">
                      <img src="assets/icons/warning.svg"
                           title="Certificat {{ certificate.environmentName }} de l'application {{ certificate.applicationName }} en fin de validité">
                      <a role="button" routerLink="certificat/{{certificate.idCertificate}}"
                         title="Renouveler le certificat {{ certificate.environmentName }} de l'application {{ certificate.applicationName }} en fin de validité">
                        Renouveler
                      </a>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>

    </div>
  </section>

</div>

<!--  <div id="cadre">
    <table id="table1">
      <thead>
      <tr>
        <th id="th1">CCX</th>
        <th class="th2">Application</th>
        <th class="th2" id="thEnv">Environnement</th>
        <th class="th2" id="thType">Type</th>
        <th id="th3">Emission</th>
        <th id="th4">Validité</th>
      </tr>
      </thead>

      <tbody *ngFor="let certificate of certificatesList | async" title="Certificat {{ certificate.environment.nameEnvironment }} de l'application {{ certificate.application.nameApplication }}">
      <tr routerLink="/certificat/{{ certificate.idCertificate }}">-->
<!--//  *ngIf="certificate.application.users[0].idUser === editedUser.idUser" -->
<!--    <td id="tdCCX">{{ certificate.application.codeCCX }}</td>
    <td>{{ certificate.application.nameApplication }}</td>
    <td id="tdEnv">{{ certificate.environment.nameEnvironment }}</td>
    <td id="tdType">{{ certificate.root.nameRoot }}</td>
    <td id="tdDate">{{ certificate.dateIssue | date: 'dd/MM/yyyy' }}</td>
    <td>
      <div *ngIf="((certificate.dateEndValidity | date: 'yyyy-MM-dd') > (alertDate | date: 'yyyy-MM-dd'))">
        <img src="assets/icons/ok.svg">
      </div>
      <div *ngIf="((certificate.dateEndValidity | date: 'yyyy-MM-dd') < (dateNow | date: 'yyyy-MM-dd'))">
        <img src="assets/icons/not_ok.svg">
        <a role="button" routerLink="certificat/{{certificate.idCertificate}}">Demander</a>
      </div>
      <div *ngIf="((certificate.dateEndValidity | date: 'yyyy-MM-dd') >= (dateNow | date: 'yyyy-MM-dd')) && ((certificate.dateEndValidity | date: 'yyyy-MM-dd') <= (alertDate | date: 'yyyy-MM-dd'))">
        <img src="assets/icons/warning.svg">
        <a role="button" routerLink="certificat/{{certificate.idCertificate}}">Renouveler</a>
      </div>
    </td>
  </tr>
  </tbody>
</table>
</div>
</section>-->

<!--
//<div>
  <button routerLink="">reset</button>
</div>-->

<!--//<div *ngIf="editedProfile.idProfile">
  <h5>Liste des utilidateurs ayant le profil {{ editedProfile.typeProfile }} :</h5>
  <div id="brut">
    <table id="table1">
      <div>
        <thead>
        <tr>
          <th>Profil</th>
          <th>Id</th>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Connexion</th>
        </tr>
        </thead>

        <tbody *ngFor="let user of usersList | async">
        <tr *ngIf="editedProfile.idProfile === user.profile.idProfile">
          <td>{{ user.profile.typeProfile }}</td>
          <td>{{ user.idUser }}</td>
          <td>{{ user.nameUser }}</td>
          <td>{{ user.firstNameUser }}</td>
          <td>
            <button routerLink="accueil/{{ user.idUser }}">Se connecter</button>
          </td>
        </tr>
        </tbody>
      </div>
    </table>
  </div>-->

<!--//<div *ngFor="let user of usersList | async">
  <div *ngIf="editedProfile.idProfile === user.profile.idProfile">->
<div class="mat-elevation-z8">
  <table mat-table [dataSource]="dataSource2" class="table2">

    <ng-container matColumnDef="userProfile">
      <th mat-header-cell *matHeaderCellDef>Profil</th>
      <td mat-cell *matCellDef="let user">
        <div *ngIf="editedProfile.idProfile === user.profile.idProfile">
          {{ user.profile.typeProfile }}
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="userId">
      <th mat-header-cell *matHeaderCellDef>Id.</th>
      <td mat-cell *matCellDef="let user">
        <div *ngIf="editedProfile.idProfile === user.profile.idProfile">
          {{ user.idUser }}
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="userName">
      <th mat-header-cell *matHeaderCellDef>Nom</th>
      <td mat-cell *matCellDef="let user">
        <div *ngIf="editedProfile.idProfile === user.profile.idProfile">
          {{ user.nameUser }}
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="userFirstName">
      <th mat-header-cell *matHeaderCellDef>Prénom</th>
      <td mat-cell *matCellDef="let user">
        <div *ngIf="editedProfile.idProfile === user.profile.idProfile">
          {{ user.firstNameUser }}
        </div>
      </td>
    </ng-container>

    <ng-container matColumnDef="connexion">
      <th mat-header-cell *matHeaderCellDef>Connexion</th>
      <td mat-cell *matCellDef="let user">
        <div *ngIf="editedProfile.idProfile === user.profile.idProfile">
          <button routerLink="accueil/{{ user.idUser }}">Connecter</button>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns2"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns2;"></tr>
  </table>
</div>
<!-</div>
</div>->
</div>

<ng-template #elseBlock>
  <mat-card class="example-card">
    <mat-card-header>
      <mat-card-title>Authentification</mat-card-title>
    </mat-card-header>
    <p>* Champs obligatoires</p>
    <mat-card-content>
      <form>
        <table id="table3" class="example-full-width" cellspacing="0">
          <tr>
            <td>
              <mat-form-field class="example-full-width">
                <input matInput placeholder="Identifiant RH" [(ngModel)]="userIdRH" name="idrh" required>
              </mat-form-field>
            </td>
          </tr>
          <tr>
            <td>
              <mat-form-field class="example-full-width">
                <input matInput placeholder="Mot de passe" [(ngModel)]="userPassword" type="password" name="password"
                       required>
              </mat-form-field>
            </td>
          </tr>
        </table>
      </form>
      <mat-spinner [style.display]="showSpinner ? 'block' : 'none'"></mat-spinner>
    </mat-card-content>
    <mat-card-actions>
      <mat-button-toggle-group>
        <mat-button-toggle value="connexion" (click)="login()">Connexion</mat-button-toggle>
      </mat-button-toggle-group>
    </mat-card-actions>
  </mat-card>
  <div>
    <h5>Liste des profils :</h5>
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="dataSource" class="table2">

        <ng-container matColumnDef="profileId">
          <th mat-header-cell *matHeaderCellDef>Id.</th>
          <td mat-cell *matCellDef="let profile">{{ profile.idProfile }}</td>
        </ng-container>

        <ng-container matColumnDef="profileType">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let profile">{{ profile.typeProfile }}</td>
        </ng-container>

        <ng-container matColumnDef="detail">
          <th mat-header-cell *matHeaderCellDef>Affichage</th>
          <td mat-cell *matCellDef="let profile">
            <button routerLink="auth/{{ profile.idProfile }}">Afficher</button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
  </div>
</ng-template>-->





